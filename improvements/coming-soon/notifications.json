{
  "title": "Push Notifications System",
  "dateCreated": "2025-10-02",
  "status": "planning",
  "priority": "medium",

  "overview": {
    "description": "Implement push notifications for notes, folders, shares, and reminders with cross-platform support",
    "currentState": {
      "notifications": "None - only in-app toast messages via Sonner",
      "alerting": "No background or push notifications"
    },
    "userNeed": [
      "Reminders for specific notes (time-based)",
      "Notification when someone shares a note",
      "Daily/weekly summary notifications",
      "Note collaboration alerts (comments, edits)",
      "Sync completion notifications"
    ]
  },

  "notificationTypes": {
    "reminders": {
      "description": "Time-based alerts for notes",
      "features": [
        "Set reminder for specific date/time",
        "Recurring reminders (daily, weekly, monthly)",
        "Snooze functionality",
        "Quick actions (view note, dismiss, snooze)",
        "Custom reminder messages"
      ],
      "priority": "high",
      "useCase": "Remind me to review meeting notes tomorrow at 9am"
    },
    "sharing": {
      "description": "Alerts for shared note activity",
      "features": [
        "Note shared with you notification",
        "Note edited by collaborator",
        "New comment on shared note",
        "Permission changes",
        "Share invitation"
      ],
      "priority": "medium",
      "useCase": "Get notified when teammate edits shared project notes"
    },
    "summary": {
      "description": "Periodic digest notifications",
      "features": [
        "Daily note count summary",
        "Weekly activity digest",
        "Unread notes reminder",
        "Folder activity summary",
        "Streak tracking (days of note-taking)"
      ],
      "priority": "low",
      "useCase": "Daily 8am notification: 'You created 5 notes yesterday'"
    },
    "sync": {
      "description": "Background sync status alerts",
      "features": [
        "Offline notes uploaded",
        "Sync conflict detected",
        "Storage limit warning",
        "Backup completed",
        "Version conflict resolution needed"
      ],
      "priority": "low",
      "useCase": "Notify when offline notes sync to cloud"
    }
  },

  "technicalImplementation": {
    "expoNotifications": {
      "library": "expo-notifications",
      "capabilities": [
        "Local notifications (no server needed)",
        "Push notifications (requires Expo push service)",
        "Badge counts on app icon",
        "Notification channels (Android)",
        "Silent notifications for background sync"
      ],
      "setup": [
        "Install expo-notifications package",
        "Configure app.json with notification settings",
        "Request user permission",
        "Set up notification handlers"
      ]
    },
    "database": {
      "newTables": [
        {
          "name": "note_reminders",
          "columns": {
            "id": "uuid",
            "note_id": "uuid (foreign key)",
            "user_id": "uuid (foreign key)",
            "remind_at": "timestamp",
            "recurrence": "enum (none, daily, weekly, monthly)",
            "message": "text (optional custom message)",
            "is_sent": "boolean (default false)",
            "created_at": "timestamp"
          }
        },
        {
          "name": "notification_preferences",
          "columns": {
            "user_id": "uuid (primary key)",
            "reminders_enabled": "boolean (default true)",
            "sharing_enabled": "boolean (default true)",
            "summary_enabled": "boolean (default false)",
            "sync_enabled": "boolean (default true)",
            "summary_time": "time (default 08:00)",
            "push_token": "text (Expo push token)"
          }
        }
      ]
    },
    "scheduling": {
      "local": "expo-notifications scheduleNotificationAsync()",
      "server": "Supabase Edge Functions + pg_cron for recurring",
      "approach": "Hybrid - local for simple reminders, server for complex recurring"
    }
  },

  "implementationPlan": {
    "phase1": {
      "name": "Basic Local Notifications",
      "duration": "8-12 hours",
      "tasks": [
        "Install and configure expo-notifications",
        "Request notification permissions",
        "Implement local notification scheduling",
        "Add 'Set Reminder' to note card menu",
        "Create reminder picker UI (date/time)",
        "Store reminders in note_reminders table",
        "Schedule local notifications on reminder save"
      ],
      "deliverable": "Users can set time-based reminders for notes"
    },
    "phase2": {
      "name": "Notification Settings",
      "duration": "6-8 hours",
      "tasks": [
        "Create notification_preferences table",
        "Add Notifications settings card",
        "Toggle for each notification type",
        "Daily summary time picker",
        "Test notification button",
        "Save preferences to Supabase"
      ],
      "deliverable": "Users can customize notification preferences"
    },
    "phase3": {
      "name": "Push Notification Infrastructure",
      "duration": "12-16 hours",
      "tasks": [
        "Set up Expo push notification credentials",
        "Register device push token",
        "Store push token in notification_preferences",
        "Create Supabase Edge Function for push sending",
        "Implement push notification for sharing events",
        "Handle notification tap (deep linking to note)"
      ],
      "deliverable": "Push notifications work for sharing events"
    },
    "phase4": {
      "name": "Recurring Reminders & Summaries",
      "duration": "16-20 hours",
      "tasks": [
        "Implement recurrence logic (daily, weekly, monthly)",
        "Set up Supabase pg_cron for server-side scheduling",
        "Create Edge Function for daily summaries",
        "Build notification templates",
        "Add quick actions (View, Snooze, Dismiss)",
        "Test cross-platform (iOS, Android, Web)"
      ],
      "deliverable": "Recurring reminders and daily summaries working"
    },
    "phase5": {
      "name": "Advanced Features",
      "duration": "12-16 hours",
      "tasks": [
        "Notification history view",
        "Snooze functionality",
        "Badge count management",
        "Notification grouping (Android)",
        "Rich notifications with images/actions",
        "Analytics for notification engagement"
      ],
      "deliverable": "Polished notification experience"
    }
  },

  "userInterface": {
    "reminderPicker": {
      "location": "Note card menu → Set Reminder",
      "fields": [
        "Date picker",
        "Time picker",
        "Recurrence dropdown (None, Daily, Weekly, Monthly)",
        "Custom message (optional)",
        "Save/Cancel buttons"
      ]
    },
    "notificationSettings": {
      "location": "Settings page → Notifications card",
      "options": [
        "Enable Reminders (toggle)",
        "Enable Sharing Alerts (toggle)",
        "Enable Daily Summary (toggle)",
        "Summary Time (time picker)",
        "Enable Sync Alerts (toggle)",
        "Test Notification (button)"
      ]
    },
    "notificationItem": {
      "display": [
        "Icon (reminder, share, summary)",
        "Title (e.g., 'Reminder: Meeting Notes')",
        "Body text",
        "Timestamp",
        "Quick actions (View, Snooze, Dismiss)"
      ]
    }
  },

  "estimatedDuration": {
    "basicReminders": "8-12 hours",
    "settings": "6-8 hours",
    "pushInfrastructure": "12-16 hours",
    "recurring": "16-20 hours",
    "advanced": "12-16 hours",
    "totalMinimum": "54-72 hours",
    "totalComplete": "54-72 hours with all features"
  },

  "platformConsiderations": {
    "ios": {
      "requirements": [
        "Request permissions explicitly",
        "Badge count management",
        "Critical alerts require special entitlement",
        "Notification grouping limited"
      ],
      "limitations": [
        "Background execution limited (15 seconds)",
        "Push notifications require Apple Developer account",
        "Cannot guarantee delivery time"
      ]
    },
    "android": {
      "requirements": [
        "Notification channels (categories)",
        "Importance levels",
        "Badge count via third-party",
        "Foreground service for background tasks"
      ],
      "advantages": [
        "Better background execution",
        "Rich notification support",
        "Notification grouping",
        "Action buttons"
      ]
    },
    "web": {
      "limitations": [
        "Push notifications require HTTPS",
        "Service worker needed",
        "Browser permission required",
        "No background execution on Safari"
      ],
      "approach": "Gracefully degrade to email notifications"
    }
  },

  "challenges": [
    "Cross-platform notification consistency",
    "Push token management and expiration",
    "Notification permission rejection handling",
    "Timezone handling for reminders",
    "Battery impact of background tasks",
    "Testing on physical devices (can't test push on simulator)"
  ],

  "securityConsiderations": [
    "Validate push tokens before sending",
    "Rate limit notifications per user",
    "Encrypt sensitive data in notifications",
    "User privacy - don't expose note content in lock screen",
    "Audit log for notification sends",
    "GDPR compliance - allow users to export/delete notification data"
  ],

  "notes": [
    "Start with local notifications (simpler, no server needed)",
    "Push notifications require Expo push service or FCM/APNs",
    "Consider email notifications as fallback for web users",
    "Notification fatigue is real - make it easy to customize",
    "Test on real devices - simulator push notifications don't work",
    "Consider notification analytics to improve engagement"
  ]
}
