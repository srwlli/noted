{
  "plan_name": "iOS Icon Fix - 3-Phase Implementation",
  "created": "2025-09-30",
  "status": "phase_1_complete",
  "priority": "high",
  "completed_date": "2025-09-30",
  "phases_completed": ["Phase 1: Quick Fix - Update app.json Icon Path"],
  "phases_skipped": ["Phase 2: Optimize Icon File Size"],
  "problem_statement": {
    "issue": "iOS app not displaying correct brand icon (noted-white.png)",
    "root_cause": "app.json line 7 points to non-existent icon.png file",
    "affected_platforms": ["iOS", "potentially Android adaptive icons"],
    "current_state": {
      "app_json_icon_path": "./assets/images/icon.png",
      "file_exists": false,
      "actual_icon_location": "./assets/images/noted-white.png",
      "icon_dimensions": "1024x1024px",
      "icon_file_size": "1.2MB (1,203,073 bytes)",
      "backup_files": ["icon-old.png", "favicon-old.png"]
    }
  },

  "phases": [
    {
      "phase": 1,
      "name": "Quick Fix - Update app.json Icon Path",
      "priority": "critical",
      "estimated_time": "2 minutes",
      "goal": "Point iOS build to correct icon file immediately",
      "steps": [
        {
          "step": 1,
          "file": "app.json",
          "action": "Update root icon path",
          "line": 7,
          "current": "\"icon\": \"./assets/images/icon.png\",",
          "new": "\"icon\": \"./assets/images/noted-white.png\",",
          "reason": "iOS uses this path for app icon generation"
        }
      ],
      "verification": [
        {
          "test": "Build iOS app locally",
          "command": "npx expo prebuild -p ios --clean",
          "expected": "Icon files generated in ios/noted/Images.xcassets/AppIcon.appiconset/"
        },
        {
          "test": "Check generated icon files",
          "command": "ls -la ios/noted/Images.xcassets/AppIcon.appiconset/",
          "expected": "Multiple icon sizes present (20pt, 29pt, 40pt, 60pt, etc.)"
        },
        {
          "test": "Rebuild app",
          "command": "npx expo run:ios",
          "expected": "App launches with noted-white.png as icon"
        }
      ],
      "rollback": {
        "action": "Revert app.json line 7 to original value",
        "note": "Not recommended - original points to non-existent file"
      },
      "completion_criteria": [
        "app.json updated",
        "iOS simulator shows correct icon",
        "TestFlight build shows correct icon"
      ]
    },

    {
      "phase": 2,
      "name": "Optimize Icon File Size",
      "priority": "high",
      "estimated_time": "10 minutes",
      "goal": "Reduce icon file size from 1.2MB to <100KB without quality loss",
      "current_problem": {
        "file_size": "1,203,073 bytes (1.2MB)",
        "target_size": "< 100KB",
        "size_issue": "Large file increases app bundle size unnecessarily",
        "note": "1024x1024 PNG icons should typically be 20-80KB"
      },
      "steps": [
        {
          "step": 1,
          "action": "Create optimized version of noted-white.png",
          "tool_options": [
            {
              "method": "ImageOptim (macOS)",
              "command": "open -a ImageOptim noted-white.png",
              "expected_reduction": "60-80% file size reduction"
            },
            {
              "method": "pngquant (command line)",
              "command": "pngquant --quality=85-95 noted-white.png -o noted-white-optimized.png",
              "expected_reduction": "50-70% file size reduction"
            },
            {
              "method": "TinyPNG API",
              "url": "https://tinypng.com/",
              "process": "Upload PNG, download optimized version",
              "expected_reduction": "60-80% file size reduction"
            },
            {
              "method": "Sharp (Node.js)",
              "command": "npx sharp-cli -i noted-white.png -o noted-white-optimized.png -- png compressionLevel=9",
              "expected_reduction": "40-60% file size reduction"
            }
          ]
        },
        {
          "step": 2,
          "action": "Verify optimized icon quality",
          "tests": [
            "Open noted-white-optimized.png in image viewer",
            "Zoom to 200% - check for artifacts",
            "Compare with original visually",
            "Verify dimensions still 1024x1024px"
          ]
        },
        {
          "step": 3,
          "action": "Replace original with optimized version",
          "commands": [
            {
              "description": "Backup original (if not already backed up)",
              "command": "cp assets/images/noted-white.png assets/images/noted-white-original.png"
            },
            {
              "description": "Replace with optimized",
              "command": "mv noted-white-optimized.png assets/images/noted-white.png"
            }
          ]
        },
        {
          "step": 4,
          "action": "Verify file size",
          "command": "ls -lh assets/images/noted-white.png",
          "expected": "File size < 100KB"
        }
      ],
      "verification": [
        {
          "test": "Check file size",
          "command": "stat -f%z assets/images/noted-white.png",
          "expected": "< 102400 bytes (100KB)"
        },
        {
          "test": "Verify image quality",
          "action": "Visual inspection at 100% and 200% zoom"
        },
        {
          "test": "Test web build",
          "command": "npm run build",
          "expected": "Smaller dist/ bundle size"
        }
      ],
      "completion_criteria": [
        "noted-white.png < 100KB",
        "No visible quality degradation",
        "Original backed up as noted-white-original.png"
      ]
    },

    {
      "phase": 3,
      "name": "Create iOS-Specific Icon Variants",
      "priority": "medium",
      "estimated_time": "15 minutes",
      "goal": "Create properly-sized iOS icon variants for optimal quality",
      "background": {
        "ios_requirements": {
          "app_store_icon": "1024x1024px (required for submission)",
          "iphone_app_icon": "180x180px @3x (iPhone)",
          "ipad_app_icon": "167x167px @2x (iPad Pro)",
          "settings_icon": "58x58px @2x",
          "spotlight_icon": "80x80px @2x",
          "notification_icon": "40x40px @2x"
        },
        "expo_behavior": "Expo automatically generates all sizes from single 1024x1024 source",
        "why_create_variants": "Optional - manual variants give more control over visual quality at small sizes"
      },
      "steps": [
        {
          "step": 1,
          "action": "Determine if custom variants are needed",
          "decision_criteria": [
            "Does icon have fine details that blur at small sizes?",
            "Does icon have text that becomes unreadable at 40x40?",
            "Do you want pixel-perfect control over all sizes?"
          ],
          "recommendation": "Test Expo's auto-generated icons first before creating manual variants"
        },
        {
          "step": 2,
          "action": "Create icon variants (if needed)",
          "tool_options": [
            {
              "method": "ImageMagick",
              "commands": [
                "convert noted-white.png -resize 1024x1024 icon-1024.png",
                "convert noted-white.png -resize 180x180 icon-180.png",
                "convert noted-white.png -resize 167x167 icon-167.png",
                "convert noted-white.png -resize 120x120 icon-120.png",
                "convert noted-white.png -resize 80x80 icon-80.png",
                "convert noted-white.png -resize 58x58 icon-58.png",
                "convert noted-white.png -resize 40x40 icon-40.png"
              ]
            },
            {
              "method": "Sharp (Node.js)",
              "script": "create-icons.js",
              "code": "const sharp = require('sharp');\nconst sizes = [1024, 180, 167, 120, 80, 58, 40];\nsizes.forEach(size => {\n  sharp('noted-white.png')\n    .resize(size, size)\n    .toFile(`icon-${size}.png`);\n});"
            },
            {
              "method": "Expo Icon Tool",
              "url": "https://icon.kitchen/",
              "process": "Upload 1024x1024 icon, download complete iOS asset catalog"
            }
          ]
        },
        {
          "step": 3,
          "action": "Configure iOS-specific icons in app.json",
          "file": "app.json",
          "location": "After line 11 (inside ios object)",
          "add": "\"icon\": \"./assets/images/ios-icons/AppIcon.appiconset\"",
          "note": "Only if using custom variants, otherwise Expo auto-generates from root icon"
        }
      ],
      "verification": [
        {
          "test": "Generate iOS project",
          "command": "npx expo prebuild -p ios --clean",
          "expected": "Icons appear in ios/noted/Images.xcassets/AppIcon.appiconset/"
        },
        {
          "test": "Inspect generated icons",
          "command": "ls -la ios/noted/Images.xcassets/AppIcon.appiconset/",
          "expected": "All required sizes present with correct names"
        },
        {
          "test": "Test on iOS simulator",
          "command": "npx expo run:ios",
          "checks": [
            "App icon shows on home screen",
            "Icon is sharp/clear (not blurry)",
            "Icon shows in Settings app",
            "Icon shows in Spotlight search"
          ]
        },
        {
          "test": "Test on physical device",
          "process": "Deploy to TestFlight or physical device",
          "checks": [
            "Icon displays correctly on device home screen",
            "Icon shows correctly in App Store listing"
          ]
        }
      ],
      "completion_criteria": [
        "All iOS icon sizes generated correctly",
        "Icons display sharply on all iOS screen sizes",
        "App Store submission requirements met"
      ]
    }
  ],

  "execution_order": {
    "immediate": [
      "Phase 1: Update app.json (REQUIRED - fixes broken iOS build)"
    ],
    "short_term": [
      "Phase 2: Optimize file size (RECOMMENDED - reduces bundle size)"
    ],
    "optional": [
      "Phase 3: Create variants (OPTIONAL - only if auto-generated icons look bad)"
    ]
  },

  "testing_checklist": {
    "after_phase_1": [
      {
        "test": "Local iOS build",
        "command": "npx expo run:ios",
        "expected": "App shows noted-white.png icon"
      },
      {
        "test": "Check app.json syntax",
        "command": "cat app.json | jq .",
        "expected": "Valid JSON, no syntax errors"
      }
    ],
    "after_phase_2": [
      {
        "test": "File size verification",
        "command": "du -h assets/images/noted-white.png",
        "expected": "< 100K"
      },
      {
        "test": "Visual quality check",
        "action": "Open icon in preview at 200% zoom"
      }
    ],
    "after_phase_3": [
      {
        "test": "iOS Simulator test",
        "platforms": ["iPhone 15", "iPad Pro"],
        "checks": ["Home screen icon", "Settings icon", "Spotlight icon"]
      },
      {
        "test": "TestFlight build",
        "command": "eas build --platform ios --profile preview",
        "checks": ["Icon shows in TestFlight", "Icon shows after install"]
      }
    ]
  },

  "common_issues": {
    "issue_1": {
      "symptom": "Icon still shows old logo after Phase 1",
      "cause": "Expo cached old icon files",
      "solution": "Run: rm -rf ios && npx expo prebuild -p ios --clean"
    },
    "issue_2": {
      "symptom": "Icon looks blurry on device",
      "cause": "Icon not high enough resolution or compression artifacts",
      "solution": "Ensure source is 1024x1024 and not over-compressed (Phase 2)"
    },
    "issue_3": {
      "symptom": "Build fails after changing app.json",
      "cause": "Typo in file path or invalid JSON",
      "solution": "Validate JSON: cat app.json | jq ."
    },
    "issue_4": {
      "symptom": "Icon has white background instead of transparent",
      "cause": "PNG doesn't have alpha channel",
      "solution": "Ensure noted-white.png has transparent background, not white fill"
    }
  },

  "rollback_plan": {
    "if_phase_1_fails": {
      "action": "Revert app.json to previous version",
      "command": "git checkout app.json"
    },
    "if_phase_2_fails": {
      "action": "Restore original icon from backup",
      "command": "cp assets/images/noted-white-original.png assets/images/noted-white.png"
    },
    "if_phase_3_fails": {
      "action": "Remove custom iOS icons, let Expo auto-generate",
      "steps": [
        "Remove ios-specific icon field from app.json",
        "Delete custom icon variants",
        "Run: npx expo prebuild -p ios --clean"
      ]
    }
  },

  "success_metrics": {
    "phase_1_success": "iOS app displays noted-white.png icon",
    "phase_2_success": "Icon file size < 100KB with no quality loss",
    "phase_3_success": "Icons sharp on all iOS devices and sizes",
    "overall_success": [
      "iOS app shows correct brand icon",
      "App bundle size reduced",
      "Icons display sharply on all screen sizes",
      "App Store submission requirements met"
    ]
  },

  "estimated_total_time": {
    "phase_1": "2 minutes",
    "phase_2": "10 minutes",
    "phase_3": "15 minutes (optional)",
    "total_minimum": "12 minutes (Phases 1+2)",
    "total_maximum": "27 minutes (all 3 phases)"
  },

  "related_files": {
    "configuration": [
      "app.json (line 7 - root icon path)",
      "app.json (lines 12-17 - iOS config)",
      "app.json (lines 30-72 - web config with favicon/manifest icons)"
    ],
    "assets": [
      "assets/images/noted-white.png (current brand icon)",
      "assets/images/icon-old.png (old Expo logo backup)",
      "assets/images/favicon-old.png (old web favicon backup)"
    ],
    "documentation": [
      "docs/README.md (branding section)",
      "CHANGELOG.md (icon implementation notes)"
    ]
  },

  "next_steps_after_completion": [
    {
      "step": 1,
      "action": "Update CHANGELOG.md",
      "add_entry": "Fixed: iOS app icon now displays correct noted-white.png brand asset"
    },
    {
      "step": 2,
      "action": "Test on Android",
      "verify": "Android adaptive icons still work correctly"
    },
    {
      "step": 3,
      "action": "Update documentation",
      "file": "docs/README.md",
      "note": "Document icon optimization process and file sizes"
    },
    {
      "step": 4,
      "action": "Clean up backups",
      "optional": "Remove icon-old.png, favicon-old.png if no longer needed"
    }
  ]
}
