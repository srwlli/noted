# Changelog

All notable changes to the Noted app will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- **Agent Communication** (2025-10-10)
  - Enables AI agents (like Claude Code) to read and write notes via secure token authentication
  - Generate 64-character tokens in Settings → Agent Communication section
  - Token format: `agent_[12_random_chars]_[52_random_chars]` (shown once with copy protection)
  - 4 Edge Functions for agent operations:
    - agent-generate-token: Creates tokens for users (requires user JWT)
    - agent-read-note: Allows agents to read note content (requires agent token)
    - agent-update-note: Allows agents to write/append to notes (requires agent token)
    - agent-revoke-token: Allows users to revoke tokens (requires user JWT)
  - Security features:
    - Bcrypt hashing (10 salt rounds) for token storage
    - 90-day automatic token expiry
    - Rate limiting: 100 requests per hour per token
    - Auto-revoke after 10 failed authentication attempts
    - XSS content validation (10 KiB size limit)
    - Optimistic locking for append mode (prevents concurrent write conflicts)
    - Ownership verification (agents can only access owner's notes)
    - Token shown only once with Cache-Control: no-store header
    - Audit logging with SHA-256 content hashes
  - Token Management UI:
    - AgentTokensSettingsCard: View all tokens with status badges (active, expired, revoked)
    - Token list shows: name, prefix, last used time, request count, expiry date
    - Copy token prefix to clipboard functionality
    - Revoke button for active tokens (idempotent)
    - GenerateAgentTokenModal: Generate new tokens with safety warnings
    - Optional token naming (e.g., "Claude Code - Desktop")
    - Modal won't close without copying token (safety feature)
    - Shows .env file usage example
  - Database schema:
    - agent_tokens table: id, user_id, token_hash, token_prefix, name, timestamps, rate limiting columns
    - agent_write_log table: token_id, note_id, content_hash, content_length, operation_type, timestamp
    - RLS policies for security (users view own tokens, service role manages all)
    - Indexes for performance (hash lookup, expiry queries, audit log queries)
  - API features:
    - Replace mode: Overwrites entire note content
    - Append mode: Adds to end with \n\n separator, requires expected_version for optimistic locking
    - Version conflict detection (409 error with current_version in response)
    - Comprehensive error codes (INVALID_TOKEN, TOKEN_EXPIRED, RATE_LIMIT_EXCEEDED, VERSION_CONFLICT, etc.)
    - Retry-After header for rate limit responses (429)
  - Documentation:
    - API documentation: docs/AGENT-COMMUNICATION-API.md (600+ lines)
    - User guide: docs/AGENT-COMMUNICATION-USER-GUIDE.md (460+ lines)
    - .env.example with token usage instructions
  - Use cases:
    - Claude Code integration for note-taking during coding sessions
    - Automated task summaries from calendars
    - AI research assistants compiling findings
    - Meeting transcription and note generation
  - Files created:
    - supabase/migrations/20251010000003_agent_communication.sql
    - supabase/functions/_shared/agent-auth.ts (shared authentication helpers)
    - supabase/functions/agent-generate-token/index.ts
    - supabase/functions/agent-read-note/index.ts
    - supabase/functions/agent-update-note/index.ts
    - supabase/functions/agent-revoke-token/index.ts
    - components/generate-agent-token-modal.tsx
    - components/settings-cards/agent-tokens-settings-card.tsx
    - docs/AGENT-COMMUNICATION-API.md
    - docs/AGENT-COMMUNICATION-USER-GUIDE.md
  - Files modified: app/(tabs)/settings.tsx (added Agent Communication card)
  - Base URL: https://ikovzegiuzjkubymwvjz.supabase.co/functions/v1
  - Production-ready with comprehensive error handling and user-friendly messages

- **Publish Notes to Public URLs** (2025-10-10)
  - Publish private notes as publicly accessible web pages with shareable URLs
  - Access via note (...) menu → Publish button in secondary actions row
  - Two-state modal: Unpublished (publish controls) → Published (share controls)
  - Unpublished state shows:
    - Rate limit progress bar (X/50 publishes remaining today)
    - URL preview with auto-generated slug from note title
    - Info about public accessibility
    - Primary "Publish Note" button
  - Published state shows:
    - Green "Published" status badge
    - Full public URL with auto-generated slug (e.g., `your-app.com/p/my-great-idea`)
    - Published date metadata (preserved on republish)
    - "Copy URL" button (auto-copies on successful publish)
    - "Share" button (native share sheet on mobile, Web Share API on web)
    - "View Public Page" button (opens in-app browser)
    - "Unpublish" button with confirmation dialog
  - Public viewing at `/p/[slug]` route (no authentication required):
    - Full markdown rendering with note title and metadata
    - Published/updated dates display
    - Share and Export HTML functionality
    - Copy Link button for easy sharing
    - 404 handling for unpublished/missing notes
  - Slug generation from note title:
    - Converts to URL-safe format (lowercase, hyphens, no special chars)
    - Collision handling with 5 retries using random suffixes
    - UUID fallback for maximum collision resistance
    - Regex validation: starts with letter, only a-z/0-9/hyphens, 1-60 chars
  - Rate limiting system:
    - 50 publishes per day per user
    - Resets daily at midnight UTC
    - Counter incremented AFTER successful publish (fair usage)
    - Visual progress bar (green if >10 remaining, amber if ≤10)
    - Error message when limit reached with reset time
  - Security features:
    - Server-side note ownership validation (prevents unauthorized publishes)
    - RLS policies for public viewing and authenticated publishing
    - Input validation (empty notes, size limits up to 100,000 chars)
    - Rate limiting enforced server-side via Edge Function
  - Database schema:
    - published_notes table: id, note_id, user_id, slug, published_at, updated_at
    - publish_rate_limits table: user_id, last_publish_at, publish_count_today, reset_at
    - 3 unique indexes on published_notes for fast slug/note_id lookups
    - Partial index on publish_rate_limits for reset_at queries
    - Trigger for auto-updating updated_at timestamp
  - RLS policies:
    - published_notes: SELECT for public (anon/authenticated), INSERT/UPDATE/DELETE for owners
    - notes: SELECT for published notes by public (allows anonymous viewing)
    - publish_rate_limits: SELECT for users, ALL for service_role (Edge Functions)
  - Edge Function (publish-note):
    - CORS headers on all 11 API responses for web compatibility
    - JWT authentication with service_role client
    - Note ownership verification before publish
    - Rate limit check BEFORE publish, increment AFTER success
    - Explicit INSERT/UPDATE to preserve original published_at timestamp
    - 5-retry slug collision handling with UUID fallback
    - Comprehensive error codes: UNAUTHORIZED, NOTE_NOT_FOUND, NOTE_EMPTY, NOTE_TOO_LARGE, RATE_LIMIT_EXCEEDED
  - Client services (services/publish.ts):
    - publishNote() - Calls Edge Function with error mapping
    - unpublishNote() - Removes from published_notes table
    - getPublishedNote() - Checks if note is published
    - getPublicNoteBySlug() - Fetches note for public viewing
    - getRateLimit() - Gets current rate limit status
    - getPublishesRemaining() - Calculates remaining quota
    - getUserPublishedNotes() - Lists all published notes for user
    - HTTP status code mapping (400→NOTE_EMPTY, 401→UNAUTHORIZED, 429→RATE_LIMIT_EXCEEDED, etc.)
  - Components:
    - PublishModal (522 lines): Bottom sheet modal with two-state UI
    - NoteActionsModal: Integrated Publish button in secondary actions
    - app/p/[slug].tsx (375 lines): Public viewing route with markdown rendering
  - User flow:
    - Open note → Tap (...) → Publish → Preview rate limit → Publish Note
    - Success → URL auto-copied → Modal updates to Published state
    - Share via Copy URL / Share button / View Public Page
    - Unpublish with confirmation dialog
    - Republish preserves original published_at date
  - Dependencies added: date-fns (date formatting), expo-web-browser (in-app browser)
  - BASE_URL environment variable for public URL generation (set via Supabase secrets)
  - Migration: 20251010000000_create_published_notes.sql (185 lines)
  - Edge Function: supabase/functions/publish-note/index.ts (299 lines)
  - Files created: services/publish.ts, components/publish-modal.tsx, app/p/[slug].tsx
  - Files modified: components/note-actions-modal.tsx (Publish button integration)
  - Confirmation dialog for unpublish action prevents accidental removal
  - Alert dialog: "Unpublish note? The public link will stop working. You can publish again later."
  - Production-ready with fixed migration (gen_random_uuid instead of uuid_generate_v4)

- **AI Note Summarization** (2025-10-09)
  - Generate concise 100-character summaries of notes using Claude Haiku AI
  - Accessible via AI Actions modal (long press note → AI Actions → Summarize)
  - Preview workflow: Generate → Preview → Cancel/Regenerate/Save (matches title generation UX)
  - Summary displays in bottom sheet modal between title and action cards
  - Stale summary detection with amber warning icon when note edited after summary
  - Regenerate button (refresh icon) to update outdated summaries
  - Database storage: ai_summary (TEXT) and summary_generated_at (TIMESTAMP) columns
  - Edge Function: ai-summarize using Claude 3.5 Haiku model
  - Cost: $0.0012 per summary (5000 character input limit, 100 character output)
  - User pays Anthropic directly (BYOK model via Settings → AI Features)
  - Service layer: summarizeNote() client function with full error handling
  - Preview before save prevents unwanted AI-generated content
  - Auto-refresh parent component after save to display summary immediately
  - Migration: 20251009000000_add_ai_summary.sql with partial index for performance
  - Components: AI Actions Modal updated with summary preview UI
  - Toast notifications for generation success/failure (top-center position)

### Changed
- **Bottom Sheet Modal Simplification** (2025-10-08)
  - Refactored NoteActionsModal from 10 actions to 3 core actions
  - Bottom sheet now shows only: Edit, Preview, Delete (in that order)
  - Removed actions: Favorite, Share, Copy, Export, Organization, Download, AI Actions
  - All removed actions still fully accessible via note card (...) menu
  - Cleaner, more focused UX with single-row action layout
  - Title field changed to read-only display (editing removed from modal)
  - Modal now triggered exclusively by long press on note card
  - Removed nested modals (AI Actions, Folder Picker)
  - Code reduction: 130 lines deleted, 13 added (62% smaller file)
  - Zero functionality loss - all features available through (...) menu
  - Improved component separation: Bottom sheet for quick actions, (...) menu for all options

### Added
- **Copy Button Functionality in Bottom Sheet** (2025-10-08)
  - Copy button in NoteActionsModal now copies note content to clipboard
  - Replaced "Coming Soon" placeholder with functional copy handler
  - Shows success toast: "Note content copied to clipboard" (top-center position)
  - Toast positioned above bottom sheet for visibility
  - Includes error handling with user-friendly error messages
  - Works on all platforms (Web, iOS, Android)
  - Reuses existing Clipboard import (expo-clipboard)
  - Matches implementation pattern from note card (...) menu Copy button
  - Bottom sheet actions increased from 7/10 to 8/10 functional
  - Implementation plan: improvements/bottom-sheet-card/copy-button-function.json
  - NOTE: This feature was added, then immediately removed in bottom sheet simplification
- **Focus-Based Notes List Refresh** (2025-10-08)
  - Notes list now automatically refreshes when returning from note editor
  - Implemented useFocusEffect hook to detect screen focus events
  - New notes appear immediately without manual refresh
  - Works for creating new notes, editing existing notes, and deleting notes
  - Eliminated confusing state where users had to pull-to-refresh to see changes
  - Clean implementation: 4 lines of code using Expo Router's useFocusEffect
  - No loading guard to prevent stale closure issues
  - handleRefresh() manages state internally (refreshing indicator)
  - Fixed root cause: router.back() doesn't trigger useEffect dependencies
  - Documentation: improvements/state-management/state-management-review-v1.json

### Added
- **Note Title Auto-Save on Blur** (2025-10-07)
  - Title field in NoteActionsModal now auto-saves when user taps away
  - No explicit "Save" button needed - changes persist automatically
  - Keyboard dismisses with "Done" button (returnKeyType)
  - Error handling with toast notification and automatic revert on failure
  - Natural UX pattern: tap title → edit → tap away → saved
  - Prevents lost edits when closing modal
- **AI Actions Accent Styling** (2025-10-07)
  - AI Actions card now uses theme accent color for visual prominence
  - Tint-colored icon, text, and border with subtle background tint
  - New `accent` property in PrimaryActionRow component (similar to `destructive`)
  - 8% opacity background tint for subtle highlighting without overwhelming UI
  - Accent styling adapts to all 10 themes automatically
  - Makes AI features discoverable without being intrusive
- **AI Title Generation with Dual Access Points** (2025-10-07)
  - Moved Generate Title feature from editor header to markdown toolbar dropdown
  - Added AI Actions modal accessible from note bottom sheet (...) menu
  - Toolbar access: Text format icon → ✨ Generate Title button
  - Bottom sheet access: (...) menu → AI Actions → Generate Title
  - Title confirmation modal shows generated title with Accept/Reject options
  - Users must approve AI-generated titles before applying to note
  - Prevents accidental title overwrites and gives users preview control
  - AI Actions modal includes placeholder for future features (Summarize, Extract Tags)
  - Automatically navigates to editor when Generate Title triggered from note list
  - Generate Title button hidden during generation to prevent duplicate requests
  - Confirmation flow works identically from both entry points
- **API Keys Status Auto-Refresh** (2025-10-07)
  - AI Features status updates immediately after saving API keys (no manual refresh needed)
  - Added refresh trigger mechanism using state counter in Settings page
  - APIKeysModal calls onKeysUpdated callback after successful save
  - AISettingsCard re-checks API keys when refreshTrigger changes
  - Eliminates confusing "Not configured" status after adding valid keys
  - Better user feedback: Status changes from ⚠ Not configured → ✓ Configured instantly
- **Share Action Card** (2025-10-07)
  - Share button now functional in Note Actions Modal
  - Mobile (iOS/Android): Opens native share sheet with note content
  - Web: Copies note content to clipboard
  - Shares plain markdown format for compatibility with other apps
  - Toast notifications for success/error feedback
  - Works with all note lengths and special characters
- **Preview Action Card** (2025-10-07)
  - Renamed "Duplicate" action card to "Preview" in NoteActionsModal
  - Changed icon from content-copy to visibility (eye icon)
  - Wired Preview button to open note in preview mode (rendered HTML)
  - Note editor now accepts `mode` parameter from URL (?mode=preview)
  - Clicking Preview closes modal and navigates to full-screen HTML preview
  - First step toward making all action cards functional (no more "Coming Soon")
- **Image Upload with Supabase Storage** (2025-10-06)
  - Implemented full image upload functionality allowing users to upload images from their device
  - Users can now upload images from photo library or paste image URLs (Google Drive, direct links)
  - Added "Upload from Device" button in image dialog modal with loading state
  - Supabase Storage bucket created (note-images) with RLS policies for user-scoped access
  - 5MB file size limit with validation and user-friendly error messages
  - File extension validation from blob MIME type (JPEG, PNG, GIF, WebP supported)
  - Auto-fill URL field after successful upload with toast notifications
  - Platform-specific permission handling (iOS/Android photo library, Web file picker)
  - TypeScript type safety with custom interfaces (UploadImageResult, UploadImageOptions, ImageUploadError)
  - Race condition prevention using mountedRef pattern for async operations
  - Fixed Google Drive image rendering by adding allowedImageHandlers prop to markdown renderer
  - Image storage organized by user: {userId}/{timestamp}_{random}.{ext} for collision prevention
  - Public bucket with RLS policies (simpler than signed URLs, still secure)
  - 3 RLS policies created: INSERT, SELECT, DELETE using SPLIT_PART for path validation
  - New files: services/images.ts (upload service), supabase/migrations/20251006204911_add_image_storage.sql
  - Modified files: package.json (expo-image-picker), image-dialog-modal.tsx (upload UI), markdown-renderer.tsx (allowedImageHandlers)
  - User testing completed successfully on iOS/Android/Web platforms
- **Image Upload Implementation Plan** (2025-10-06)
  - Comprehensive implementation plan for image upload with Supabase Storage integration
  - Phase 1: Google Drive URL fix with allowedImageHandlers prop
  - Phase 2: Device image upload using expo-image-picker
  - Supabase Storage bucket configuration with RLS policies for user-scoped private storage
  - 5MB file size limit with validation and compression
  - Platform permissions handling (iOS photo library, Android storage, Web file picker)
  - Complete code examples: services/images.ts, updated image-dialog-modal.tsx, markdown-renderer.tsx
  - Step-by-step implementation checklist with user testing gate before commit/push
  - Risk assessment: Low-Medium risk with detailed mitigation strategies
  - Difficulty assessment: Medium complexity with breakdown by task
  - Troubleshooting guide for common issues
  - File: improvements/image-upload-implementation.json (641 lines, ready for agent execution)
- **Image Button in Markdown Toolbar** (2025-10-06)
  - Added image button to markdown toolbar dropdown for inserting images into notes
  - Button positioned between Link and Table buttons with image icon
  - Opens ImageDialogModal with two input fields: Alt Text and Image URL
  - Generates markdown syntax: `![alt](url)` for image insertion
  - Modal features: Alt text pre-fill from selection, URL validation, theme-aware styling
  - Components updated: markdown-toolbar-dropdown.tsx (actual toolbar used by editor)
  - Note: Initially added to wrong component (markdown-toolbar.tsx), then corrected
  - Fixed issue where button wasn't visible in note editor (commit 7c1e674)
  - Image rendering in preview mode enabled
- **Dashboard Folder Menu Integration** (2025-10-06)
  - Added folder dropdown controls to the Dashboard header for parity with Notes/Folders tabs
  - Reused FolderModal and delete confirmation so folder CRUD works from the home screen
  - Selecting a folder on the Dashboard routes to Notes with the folder preselected
  - Kept a unified folderRefreshTrigger to sync dropdown data across tabs
- **Folders Tab with Quick Access** (2025-10-06)
  - Transformed "Soon" placeholder tab into dedicated Folders hub
  - Tab 4 of 5 (Info → Notes → Dashboard → Folders → Settings) for thumb-accessible navigation
  - Vertical list of folder cards showing all user folders
  - Tap folder card to navigate to Notes tab with that folder selected
  - Empty state with "Create Folder" CTA button for new users
  - Pull-to-refresh support for manual folder list reload
  - Cross-tab synchronization via folderRefreshTrigger (folder dropdown updates everywhere)
  - Folder cards show icon + name only (no body content when collapsed)
  - (...) menu on each folder card with Rename, Add/Remove Favorites, Delete options
  - Folder creation, renaming, and deletion via FolderModal and ConfirmationModal
  - Loading spinner during initial data fetch
  - Error message display with retry capability
  - Comprehensive JSDoc and inline comments for maintainability
  - Tab icon changed from schedule (clock) to folder
  - Phase 1 implementation complete (Phase 2: note counts, timestamps, special cards planned)
- **Folder Favorites System** (2025-10-06)
  - Add folders to favorites via (...) menu in Folders tab
  - Star icon (★/☆) indicates favorite status in menu
  - Toggle favorite status with toast notifications (top-center position)
  - Favorite folders appear on Dashboard between favorite notes and recent notes
  - Dashboard section order: favorite notes (top) → favorite folders (middle) → last 3 recent notes (bottom)
  - Dashboard dividers separate each section for clean visual hierarchy
  - Tap favorite folder card on Dashboard to navigate to Notes tab
  - Database field: is_favorite boolean on folders table
  - Service methods: getFavoriteFolders(), toggleFavorite(folderId, isFavorite)
  - Parallel loading of notes and folders on Dashboard (Promise.all for performance)
  - State synchronization ensures favorite icon reflects actual status
  - Folder cards on Dashboard match Folders tab design (icon + name, header only)
  - Database migration: 20251006000000_add_folder_favorites.sql adds is_favorite column with index
  - Graceful error handling: Dashboard loads even if migration not yet applied
  - Individual try/catch prevents favorites failure from crashing entire Dashboard
- **Auto-Assign Notes to Folder** (2025-10-06)
  - New notes created while viewing a folder are automatically assigned to that folder
  - Folder ID passed via URL parameter from Notes page to note editor
  - "All Notes" and "Unfiled" views create notes without folder assignment
  - Seamless organization workflow: select folder → create note → note appears in that folder
  - Reduces manual "Move to Folder" actions after note creation
- **Dashboard with Favorites and Recent Notes** (2025-10-05)
  - New Dashboard tab as home page (index route) with 'home' icon
  - Three-section layout: favorite notes (top) → favorite folders (middle) → last 3 recent notes (bottom)
  - Favorites section displays favorited notes without header for clean design
  - Favorite folders section in middle with horizontal divider
  - Last 3 section shows 3 most recently modified non-favorite notes with horizontal divider
  - Notes in favorites excluded from Last 3 to avoid duplication
  - Empty state cards for new users: "Add fav for quick access" and "Last 3 notes here"
  - Empty state dismisses when user adds notes or favorites
  - Auto-refresh via useFocusEffect hook when Dashboard tab gains focus
  - Database migration adds is_favorite boolean column with 2 performance indexes
  - Partial index on (user_id, is_favorite) for fast favorite queries
  - Partial index on (user_id, updated_at DESC) for Last 3 query optimization
  - 'Add to Favorites' action in popup menu (...) with star/star-border icon
  - 'Favorite' primary action card in long-press modal with dynamic label
  - Toast confirmation when toggling favorite status (sonner-native)
  - User stays on current note when favoriting (not redirected)
  - State synchronization ensures favorite icon reflects actual status
  - Service methods: toggleFavorite(), getFavoriteNotes(), getRecentNonFavoriteNotes()
  - Tab navigation updated: Info → Notes → Dashboard → Folders → Settings (Dashboard centered)
  - Notes list moved from index to dedicated 'notes' route
  - Migration file: 20251005000000_add_is_favorite_column.sql
- **Mobile Long Press Actions** (2025-10-05)
  - Added long press gesture on note cards to open actions modal (mobile only)
  - Long press on note title triggers full NoteActionsModal with 9 actions
  - Platform check ensures gesture only works on iOS/Android (not web)
  - Actions modal now available on all notes via long press or (...) button
  - Test note continues to use (...) button → modal for testing
  - Regular notes have both (...) dropdown menu AND long press → modal
  - Provides quick access to Edit, Share, Duplicate, AI Actions, Export, Organization, Copy, Delete, Download
  - Native mobile gesture pattern for intuitive note management
- **Unfiled Notes Filter** (2025-10-04)
  - Added "Unfiled" option to folder dropdown menu for viewing notes without folder assignment
  - Shows only notes where folder_id is NULL
  - Uses folder-off icon to indicate unorganized notes
  - Menu structure now: All Notes → Unfiled → [User Folders] → New Folder
  - Updated getNotesByFolder() to handle 'unfiled' special case
  - Helps users quickly find and organize notes that haven't been filed yet
- **Note Editor Navigation Controls** (2025-10-04)
  - Added back arrow button to all note editor headers (new, edit, loading, error states)
  - Uses MaterialIcons "arrow-back" with theme-aware colors
  - Navigates back to notes list via `router.back()`
  - Consistent styling across all header buttons (marginLeft: 16, activeOpacity: 0.7)
- **Markdown Editor with Toolbar** (2025-10-03)
  - Implemented full-featured markdown editor as alternative to modal editor
  - Feature flag controlled: `USE_MARKDOWN_EDITOR` in `config/features.ts` (enabled by default)
  - Full-screen editing experience with edit/preview toggle
  - 8-button formatting toolbar: Bold, Italic, H1, H2, List, Code, Link, Table
  - Link dialog modal for creating `[text](url)` markdown links
  - Table generator modal with visual grid picker (2-10 rows, 2-8 cols)
  - HTML export functionality (web download, mobile share)
  - Auto-save with 1000ms debounce after typing stops
  - Error boundary with graceful fallback and user-friendly error screen
  - Smooth slide-in animations for native app feel
  - Theme-aware markdown rendering with 18-color palette support
  - Dual-editor strategy: Both old modal and new markdown editor maintained
  - Zero breaking changes: Instant rollback by toggling feature flag
  - Test route accessible via Settings → Developer → Test Markdown Editor
  - Components: `markdown-editor.tsx`, `markdown-renderer.tsx`, `markdown-toolbar.tsx`, `link-dialog-modal.tsx`, `table-generator-modal.tsx`, `markdown-error-boundary.tsx`
  - Services: `markdown-service.ts` for HTML conversion
  - Utils: `note-parser.ts` for title extraction
  - Routes: `app/note-editor/new.tsx`, `app/note-editor/[id].tsx`, `app/note-editor/test.tsx`
  - Documentation: `MARKDOWN_EDITOR_IMPLEMENTATION.md`
  - Implementation timeline: 5 checkpoints, 17 tasks (commits: 71b7224, 0804a17, 3a29c10, 63ad9b4, 4d9c738)
- **Coming Soon Feature Synchronization** (2025-10-02)
  - Created comprehensive planning docs for all Coming Soon features
  - Added 5 new plan files: ide-integration.json, exports.json, n8n-automation.json, themes-and-styles.json, sharing-collaboration.json
  - Added Search Bar and Advanced Filters to Coming Soon card (now showing 11 features total)
  - Moved website-plan.json to improvements/business/ (not a user feature)
  - Now all features in UI have corresponding detailed implementation plans
  - Feature list includes: Rich Text Editor, Search Bar, Advanced Filters, Sharing and Collaboration, Exports, Private Notes, Data Abstraction, IDE Integration, n8n Automation, New Themes and Styles, AI Integrations
- **Universal Card Component** (2025-10-02)
  - Created universal Card component (`components/common/card.tsx`) ensuring pixel-perfect consistency across all card types
  - Single source of truth for card structure: borderWidth 1, borderRadius 12, padding 16
  - Header always includes bottom border for visual separation
  - Supports both accordion mode (collapsible content) and static mode (always visible)
  - Empty children handling to prevent unnecessary spacing
  - All info cards migrated to use Card wrapper (download, quick-start, tech-stack, coming-soon, contact)
  - Note cards refactored to use Card component while maintaining independent expansion behavior
  - Eliminated duplicate card styling code across 6 components

### Added
- **Info Page Accordion Cards** (2025-10-02)
  - Created Download Card with iOS/Android/PC tabs and auto-detection
  - Platform-specific installation instructions for PWA setup
  - Quick Start Card with app actions organized by location (Header, Folder, Card, Tab Bar)
  - Tech Stack Card displaying technologies used (Frontend, Backend, UI/UX, PWA Features)
  - Coming Soon Card listing planned features
  - Contact Card with email contact information
  - Accordion UI pattern with single-card expansion state management
  - Horizontal divider lines between sections for improved visual separation
  - All cards use theme colors for consistent styling
- **Folders for Note Organization** (2025-10-02)
  - Created `folders` table with RLS policies for user-specific folder access
  - Added `folder_id` column to notes table (nullable, ON DELETE SET NULL)
  - Database constraints ensure folder names are not empty (max 255 characters)
  - Folder icon in header with dropdown menu for navigation and creation
  - "All Notes" default view shows all notes across folders
  - "Move to Folder" submenu in note card (...) menu for quick organization
  - New folder creation via header menu with validation modal
  - Real-time folder filtering without page reload
  - Services layer: `services/folders.ts` with full CRUD operations
  - Updated `services/notes.ts` with `getNotesByFolder()` method
  - Components: `FolderModal` for creation/renaming, folder dropdown in `CommonHeader`
  - Migration: `20251002120000_add_folders.sql`
  - Uses MaterialIcons and react-native-popup-menu for consistent UI
  - Foundation for nested folders via `parent_folder_id` (future enhancement)
- **Memory Leak Fix in NoteItem Component** (2025-10-02)
  - Fixed critical memory leak causing 4.5GB memory usage during development
  - Added cleanup useEffect to properly remove event listeners on unmount
  - Memoized all callback functions with useCallback to prevent listener accumulation
  - Wrapped component with React.memo() and custom comparison function
  - Prevents unnecessary re-renders when parent updates
  - Expected impact: 84% memory reduction (4.5GB → 700MB-1GB stable)
  - Fixes event listener accumulation from react-native-popup-menu Menu component
  - Component now only re-renders when note.id or note.updated_at changes
- **Database Input Validation Constraints** (2025-10-02)
  - Title max length: 200 characters (enforced at database level)
  - Title cannot be null or empty/whitespace
  - Content max length: 50,000 characters (~10 pages)
  - Prevents database corruption and malicious input
  - Migration: `20251002032805_add_note_constraints.sql`
- **Frontend Input Validation** (2025-10-02)
  - Real-time character counters (e.g., "150/200" for title)
  - Visual feedback: red borders when exceeding limits
  - Red counter text when over character limit
  - maxLength props prevent typing beyond limits
  - Validation errors before save with clear messages
  - Auto-trim whitespace before saving
  - Two-layer protection: frontend UX + database security
- **18-Color Theme System** (Phase 2.1 - selectedSurface)
  - Added selectedSurface color (9th Phase 2 color) for selected/active item states
  - Provides visual feedback when note card menu is open
  - Semantically distinct from elevatedSurface (selection vs elevation)
  - All 10 themes include selectedSurface in light and dark modes
- **10-Theme Color Spectrum** (5 new themes added)
  - Forest: Natural green aesthetic for calm and focused work
  - Lavender: Soft purple aesthetic for creative work
  - Amber: Warm amber tones for energetic focus
  - Midnight: True black for OLED screens with maximum contrast
  - Rose: Soft rose aesthetic for gentle, modern design
  - Complete color spectrum coverage: grey, teal, brown, blue, red, green, purple, orange, black, pink
- **17-Color Theme System** (Phase 2 of Theme Expansion)
  - Expanded from 9 to 17 colors per theme for richer UI design
  - Added elevatedSurface for layered UI elements (modals, popovers)
  - Added overlay for semi-transparent modal backdrops
  - Added hover and pressed states for interactive elements
  - Added disabled state for non-interactive elements
  - Added highlight color for selections and notifications
  - Added linkColor for hyperlinks (distinct from buttons)
  - Added accentSecondary for visual variety
  - All themes updated with full 18-color palettes (180 total color values per theme)
  - Backward compatible: existing components work unchanged
- **New Themes Added** (Phase 1 of Theme Expansion)
  - Sepia: Warm vintage aesthetic for comfortable reading with brown earth tones
  - Nord: Cool Arctic-inspired palette for focused work with blue accents
  - Total themes increased from 2 to 10 across multiple phases
- **Modal Theme Picker**
  - Full-screen modal with large theme previews (120x80px showing background, surface, text, tint)
  - Light/Dark preview toggle to see themes before applying
  - Responsive grid layout (2 columns mobile, 3 columns desktop)
  - Selected theme indicator with "Current" badge
  - Smooth slide-up animation
- **Brand Icon Implementation**
  - Replaced generic placeholder icons with custom `noted-white.png` brand asset
  - Unified icon across browser favicon, PWA desktop shortcuts, iOS home screen, and Android launchers
  - Added branding assets documentation to README
- **Theme System Architecture Overhaul** (All 5 improvements completed 2025-09-30)
  - Extracted theme validation to `VALID_THEME_NAMES` constant for automatic validation updates
  - Added `DEFAULT_THEME_NAME` and `DEFAULT_COLOR_SCHEME` constants for single source of truth
  - Created typed storage utility (`lib/theme-storage.ts`) for type-safe theme persistence
  - Added theme metadata with `displayName` and `description` fields for professional UI
  - Implemented error state tracking with user-visible error banner in settings
  - System now ready for easy addition of new themes without code duplication

### Changed
- **Dashboard Last 3 Section Divider** (2025-10-06)
  - Replaced "Last 3" text header with horizontal divider line
  - Divider uses theme's border color for consistent styling across all themes
  - Maintains same spacing as original text (24px top, 12px bottom)
  - Cleaner visual separation between favorites and recent notes sections
- **Markdown Toolbar Icon** (2025-10-04)
  - Changed toolbar icon from `format-size` to `text-format` in note editor headers
  - Better represents diverse formatting options (Bold, Italic, Headers, Lists, Code, Links, Tables)
  - More semantically accurate than font-size-specific icon
- **Toast Notifications for Note Actions** (2025-10-04)
  - Replaced blocking Alert.alert() modals with non-blocking toast notifications
  - Move to folder now displays actual folder name (e.g., "Note moved to Work")
  - Copy note action now uses toast instead of native alert
  - Consistent notification system across entire app using sonner-native
  - Better web compatibility and smoother user experience
- **Info and Settings Card Toggle Animation** (2025-10-04)
  - Improved accordion card toggle behavior with smooth transitions
  - Clicking one card now closes the current card before opening the new one
  - Added 200ms delay between close and open for smooth visual transition
  - Applied to both info page and settings page cards
- **Card Component Standardization** (2025-10-02)
  - Refactored all info cards to use universal Card component instead of inline structure
  - Refactored note-item.tsx to use Card component for consistent sizing
  - Refactored settings page into 3 card components (theme, profile, account)
  - Note card button sizes reduced from 32x32 to 24x24 to match info card icons
  - Collapsed card heights now identical across notes, info, and settings pages
  - Visual consistency: all cards share same border, padding, radius, and header structure
  - Standardized chevron icons across all cards (keyboard-arrow-down/right, size 24, textSecondary color)
  - Settings page reduced from 242 to 60 lines (75% reduction)
  - Settings cards now collapsible with single-card expansion pattern
  - Note card title click area expanded (chevron + title both trigger expansion)
- **Info Page Structure**
  - Renamed "docs" tab to "info" tab
  - Reordered header icons: refresh, folder, new note (left to right)
  - Replaced static content cards with interactive accordion cards
  - Single-card expansion ensures focused content consumption
- **Theme Names Modernized**
  - Renamed greyscale → Monochrome (pure cool neutrals)
  - Renamed bearRedGraphite → Crimson (rich red aesthetic)
  - Renamed appleNotes → Ocean (vibrant teal/turquoise)
  - Updated DEFAULT_THEME_NAME to 'monochrome'
- **Note Card UX Improvements**
  - Decluttered note cards by consolidating actions into overflow menu
  - Removed inline editing in favor of modal editing (preparing for rich text)
  - Replaced centered modal menu with contextual dropdown using react-native-popup-menu
  - Added visual highlight (selectedSurface background) when note menu is active
- **Info Page Reorganization**
  - Reordered cards: Quick Start (new), About, Git, Contact (new)
  - Removed README and Integrations cards
  - Added Quick Start onboarding card
  - Added Contact support card
- **Settings Page Cleanup**
  - Removed "Theme Style" label above theme picker
  - Renamed Debug section → Profile
  - Profile section now shows only user email
  - Removed debug color/scheme display fields
- **Theme Selection UI Enhancement**
  - Replaced horizontal card grid with compact selector button in settings
  - Settings page now shows single-row theme selector with color preview dots
  - Tapping selector opens full-screen modal theme picker
  - Scalable design supports 10+ themes
- **Icon Assets**
  - Moved `noted-white.png` to `assets/images/` directory for proper organization
  - Updated `app.json` favicon and PWA manifest icon references
  - Updated `app/+html.tsx` Apple touch icon paths
  - Backed up old icons as `favicon-old.png` and `icon-old.png`
- **Theme System**
  - Theme validation now automatically includes new themes when added to `Themes` object
  - Default theme and color scheme defined via constants instead of magic strings
  - Backward compatibility export now uses `DEFAULT_THEME_NAME` constant
  - Removed `Colors` object dependency in tab layout (app/(tabs)/_layout.tsx:17,28,29)
  - All AsyncStorage theme operations now use typed `ThemeStorage` utility
  - Settings UI displays theme metadata (displayName/description) for better UX
  - Error banner shows when theme preferences fail to load

### Technical Improvements
- **Theme System Architecture**: Complete refactor for maintainability and extensibility
  - Single source of truth for theme validation (constants/theme.ts:88 - VALID_THEME_NAMES)
  - Eliminated magic strings ('greyscale', 'system') throughout codebase
  - Enhanced type safety with default theme constants and typed storage utility
  - Type-safe AsyncStorage wrapper (lib/theme-storage.ts) with ThemeName/ColorSchemeMode types
  - Error state propagation from storage layer to UI with user-facing error messages
  - Theme metadata system supports future extensibility (icons, preview colors, etc.)
- Professional asset organization with semantic naming conventions

### Known Issues
- Safe area CSS causing excessive whitespace above header and below footer on non-iOS devices
- Need to restrict safe area padding to standalone PWA mode only
- TypeScript errors related to web CSS strings in React Native styles (non-critical)

### Removed
- **Unused Markdown Toolbar Component** (2025-10-06)
  - Archived markdown-toolbar.tsx to improvements/archived/ (never integrated into codebase)
  - Component was part of original markdown editor plan but replaced by dropdown pattern
  - Dropdown toolbar (markdown-toolbar-dropdown.tsx) chosen for better mobile UX
  - Original design: Always-visible inline toolbar above keyboard (KeyboardAvoidingView)
  - Dropdown benefits: Saves screen space, on-demand display, better platform consistency
  - Component remains complete with all 9 buttons (B, I, H1, H2, List, Code, Link, Image, Table)
  - Created comprehensive documentation: improvements/archived/markdown-toolbar-ARCHIVED.md
  - Documentation includes: why archived, original purpose, replacement rationale, re-implementation guide
  - Component can be restored if needed for web platform or user preference settings
  - Git history preserved via `git mv` (not deleted)
- **Test Note (NOTE-MODAL-TEST)** (2025-10-05)
  - Removed development test note from All Notes view
  - Test note was used to demonstrate modal actions during development
  - All notes now have consistent menu and modal behavior
  - Simplified loadNotes() function by removing conditional test note injection (37 lines removed)
- **Legacy Modal Note Editor** (2025-10-04)
  - Removed old modal-based note editor code from notes screen
  - Removed `NoteModal` component imports and state management
  - Removed `USE_MARKDOWN_EDITOR` feature flag conditional logic
  - All notes now use full-screen markdown editor exclusively
  - Simplified notes screen code by eliminating dual-editor complexity
- "Welcome back!" toast notification on login for cleaner, less intrusive UX

### Fixed
- **Dashboard Note Delete Functionality** (2025-10-06)
  - Fixed delete button appearing but not working on Dashboard note cards
  - Added deleteNote state variable to Dashboard component
  - Added confirmDeleteNote handler matching Notes page implementation
  - Added onDelete prop to all NoteItem components (favorite notes and recent notes)
  - Added ConfirmationModal for note deletion with "This action cannot be undone" warning
  - Root cause: Dashboard was missing delete callback wiring despite delete button being rendered
  - Note cards now have consistent functionality across all tabs (Dashboard, Notes, Folders)
- **Folder Dropdown Not Loading on Dashboard and Notes** (2025-10-06)
  - Fixed folder dropdown being empty on Dashboard and Notes tabs
  - Root cause: useEffect dependency array was incomplete, missing onFolderSelect prop
  - When parent components finished loading, they passed onFolderSelect but effect didn't re-run
  - Wrapped loadFolders in useCallback for stable function reference
  - Added onFolderSelect and loadFolders to useEffect dependency array
  - Effect now properly triggers when prop becomes available
  - Folders now load correctly on all tabs (Dashboard, Notes, Folders)
  - Fixed in common-header.tsx with atomic, modular approach
- **Toast Notifications Blocked by Modal** (2025-10-06)
  - Fixed toast notifications being hidden behind NoteActionsModal bottom sheet
  - Changed toast position to `top-center` for all modal-triggered actions
  - Favorite toggle and "Coming Soon" toasts now appear above modal backdrop
  - Ensures toast visibility when modal covers bottom of screen (up to 80% height)
  - Affects: Favorite action, all Coming Soon action placeholders in modal
- **Favorites Database Migration Not Applied** (2025-10-06)
  - Fixed is_favorite column migration not applied to remote database
  - Repaired migration history conflict (20251002130000 orphan migration)
  - Ran `supabase migration repair` and `supabase db push` to apply migration
  - Resolved 3 issues: favorites not persisting, modal favorite button failing, dashboard load errors
  - All favorite functionality now working correctly across all pages
- **New Note Button Routing After Index Rename** (2025-10-06)
  - Fixed "+" button in header routing to old index instead of note editor
  - Updated fallback route from `/?openModal=true` to `/note-editor/new`
  - New note button now works from all tabs (Dashboard, Info, Settings, Soon)
  - Previously only worked from Notes page which had explicit onNewNote prop
- **Toast Notification Bottom Positioning** (2025-10-04)
  - Added 60px bottom offset to Toaster component
  - Prevents toast notifications from being cut off or overlapped by tab bar
  - Ensures full visibility on all platforms (web PWA, iOS, Android)
  - Accounts for tab bar height (44px) + safe area padding + visual spacing
- **Markdown Editor Focus Restoration** (2025-10-04)
  - Fixed TextInput losing focus after toolbar formatting actions on iOS
  - Added TextInput ref for programmatic focus control
  - Implemented `restoreFocus()` method with iOS-optimized timing (200ms delay)
  - Added `setSelection()` API fallback for newer React Native versions (deprecated `setNativeProps` replacement)
  - Delayed modal close by 250ms to prevent iOS from interrupting focus restoration
  - Automatically restores focus and cursor position after all toolbar actions (Bold, Italic, Headings, Lists, Code, Links, Tables)
  - Users can now format text and immediately continue typing without manual refocus
  - Improved writing flow: reduced from 6 steps to 4 steps per formatting action
  - Verified working on iOS, Android, and Web with proper keyboard handling
- **Note Editor Double Header Issue** (2025-10-04)
  - Fixed double header display showing both "note-editor" and screen-specific titles
  - Added `headerShown: false` for note-editor route in root Stack layout
  - Removed redundant screen title definitions from `note-editor/_layout.tsx`
  - Child screens now fully control their own headers via `<Stack.Screen>` components
  - Maintains shared navigation config (animations, gestures) in layout file
  - Result: Clean single-header display with proper theme colors and dynamic buttons
- **iOS App Icon Path** (Phase 1 - iOS Icon Fix)
  - Updated app.json line 7 to point to correct `noted-white.png` asset
  - Fixed broken iOS builds caused by reference to non-existent icon.png file
  - Backed up original 1024x1024 icon as `noted-white-original.png`
- Tab sliding animation by removing haptic feedback component
- Type indexing errors in tab layout by using `colors` from `useThemeColors()` hook

## [1.0.0] - 2025-09-21

### Added
- **Progressive Web App (PWA) Features**
  - Service worker with caching strategies for offline functionality
  - Web app manifest for installation prompts
  - Install cards for desktop and mobile with browser-specific instructions
  - Offline fallback page
- **Material Design Icons Integration**
  - Google Fonts CDN integration for reliable icon rendering
  - Replaced custom IconSymbol with MaterialIcons across all tabs
- **Enhanced Deployment Workflow**
  - Git-based auto-deployment through Vercel
  - Persistent PWA configuration in source files
  - Custom HTML template for consistent build output

### Changed
- Removed tab bar text labels for cleaner icon-only interface
- Updated Vercel configuration for static PWA builds
- Improved tab interaction by removing haptic feedback

### Fixed
- Material Icons rendering as squares by adding Google Fonts CDN
- Build configuration overwriting by moving settings to source files
- Deployment conflicts by implementing git-based workflow
- Tab sliding animations by removing PlatformPressable component

### Technical Improvements
- Custom HTML template (`app/+html.tsx`) for persistent configurations
- Proper safe area CSS variables for iOS support
- Optimized caching strategies in service worker
- Browser and device detection for install instructions

## [0.3.0] - 2025-09-20

### Added
- Complete notes CRUD implementation with enhanced UX
- Real-time note saving and editing capabilities
- Note deletion with confirmation modals

### Improved
- User interface design and user experience
- Form validation and error handling

## [0.2.0] - 2025-09-19

### Added
- Supabase authentication with custom UI
- Protected routes and authentication guards
- User session management

### Implemented
- Sign in/sign up functionality
- Secure authentication flow
- Route protection for authenticated content

## [0.1.0] - 2025-09-18

### Added
- Initial notes app implementation
- Shared layout system
- Documentation pages
- Comprehensive theme system with greyscale colors
- Dark/light mode support

### Infrastructure
- Expo React Native framework setup
- TypeScript configuration
- Basic navigation structure
- Theme context and color system

---

## Development Notes

### PWA Implementation Details
The PWA implementation includes comprehensive offline support, install prompts for both desktop and mobile platforms, and proper iOS safe area handling. The service worker implements intelligent caching strategies for app shell, API responses, and static assets.

### Deployment Workflow
The project uses git-based deployment through Vercel, eliminating manual deployment conflicts. All PWA configurations are maintained in source files to prevent build overwrites.

### Icon System
Transitioned from custom IconSymbol to Material Design Icons with Google Fonts CDN for reliable cross-platform rendering and consistent design language.
